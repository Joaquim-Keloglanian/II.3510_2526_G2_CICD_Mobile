# =====================================================================================
#  CI/CD for Android using GitHub Actions, Firebase App Distribution, and Fastlane
#
#  This workflow is a template for students to complete.
#  Follow the instructions in each `TODO` comment to build the CI/CD pipeline.
#  Refer to your `SETUP-GUIDE.md` for hints and context.
# =====================================================================================

name: Android CI & Firebase Distribution

on:
  push:
    branches: [ "main" ]
  pull_request:
    branches: [ "main" ]

jobs:
  build-test-distribute:
    runs-on: ubuntu-latest

    # TODO: Step 1 - Specify the Build Environment
    # Your secrets are stored in a GitHub Environment. You need to tell this job
    # to use that environment so it can access the secrets.
    # Add the `environment` key here and provide the name of the environment you created.
    # Hint: Check section 2.1 of your SETUP-GUIDE.md.


    # TODO: Step 2 - Create Environment Variables from Secrets
    # Use the `env` block to make your secrets available as environment variables.
    # You will need to create variables for:
    # - GOOGLE_SERVICES_JSON_BASE64
    # - FIREBASE_APP_ID_ANDROID
    # - FIREBASE_TOKEN
    # - FIREBASE_TESTERS
    # Also add FIREBASE_RELEASE_NOTES with a message like "CI Build - Automated".
    # Example -> MY_VARIABLE: ${{ secrets.MY_SECRET_NAME }}


    steps:
      # This step checks out a copy of your repository's code. No changes needed here.
      - name: Checkout code
        uses: actions/checkout@v4

      # TODO: Step 3 - Set up JDK 17
      # The project needs Java to build. Use the `actions/setup-java@v4` action.
      # You need to configure it with the following `with` parameters:
      #   - java-version: '17'
      #   - distribution: 'temurin'
      #   - cache: 'gradle' (this speeds up future builds)


      # TODO: Step 4 - Make the Gradle wrapper executable
      # The `gradlew` script (used to build the app) needs to be executable.
      # Add a `run` step with the command: chmod +x ./gradlew


      # TODO: Step 5 - Decode and create google-services.json
      # This file is needed to connect to Firebase. It is stored as a Base64 secret.
      # Add a `run` step to decode the GOOGLE_SERVICES_JSON_BASE64 variable
      # and write it to the `app/google-services.json` file.
      # Hint: See section 2.3 of SETUP-GUIDE.md for the decode command.


      # TODO: Step 6 - Build the App and Run Tests
      # Add a `run` step to execute the Gradle tasks. It is best practice to
      # clean, check code quality (lint), run tests, and then build the APK.
      # The tasks are: `./gradlew clean lint test assembleDebug`


      # TODO: Step 7 - Install the Firebase CLI
      # You need the Firebase Command-Line Tool to distribute the app.
      # Add a `run` step to install it using: curl -sL https://firebase.tools | bash
      # IMPORTANT: This step should only run on pushes to the 'main' branch.
      # Use an `if` condition for this: `if: github.event_name == 'push' && github.ref == 'refs/heads/main'`


      # TODO: Step 8 - Distribute to Firebase App Distribution
      # The final step! Use the Firebase CLI to send the APK to your testers.
      # Add a `run` step with the `firebase appdistribution:distribute` command.
      # You will need to provide the app path, app ID, testers list, release notes, and token
      # by referencing the environment variables you created in Step 2.
      # IMPORTANT: This step should also only run on pushes to 'main'. Use the same `if` condition.
      # Example: firebase appdistribution:distribute <path_to_apk> --app "${{ env.FIREBASE_APP_ID_ANDROID }}" ...

